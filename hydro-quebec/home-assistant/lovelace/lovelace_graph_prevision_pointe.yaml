type: custom:apexcharts-card
header:
  show: true
  title: Probabilités de Pointe Critique
graph_span: 6d
span:
  start: day
  offset: +1d
color_list:
  - teal
  - cyan
  - lightblue
apex_config:
  legend:
    onItemClick:
      toggleDataSeries: false
    onItemHover:
      highlightDataSeries: false
  markers:
    size: 0
  tooltip:
    enabled: false
  chart:
    height: auto
  dataLabels:
    dropShadow:
      enabled: true
      opacity: 0.8
  plotOptions:
    bar:
      columnWidth: 100%
      colors:
        ranges:
          - from: 70
            to: 100
            color: lightgreen
  stroke:
    width: 2
  xaxis:
    type: numeric
    tickAmount: 6
    tooltip:
      enabled: false
    axisTicks:
      show: true
      offsetY: 0
      offsetX: -1
      height: 7
    labels:
      show: true
      trim: true
      rotate: -45
      rotateAlways: false
      offsetX: 8
      offsetY: -4
      style:
        fontSize: 10px
      formatter: |
        EVAL:function(value, timestamp) {
          var daysOfWeek = ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'];
          var date = new Date(timestamp);

          var diff = date - Date.now();
          let diffDays = Math.floor(diff / (1000 * 3600 * 24));

          return diffDays >= 6 ? '' : `${daysOfWeek[date.getDay()]} ${date.getDate()}`;
        }
yaxis:
  - id: first
    min: 0
    max: ~80
    decimals: 0
    apex_config:
      title:
        text: "%"
        rotate: 0
  - id: second
    min: ~-20
    max: ~-10
    opposite: true
    decimals: 0
    apex_config:
      title:
        text: °C
        rotate: 0
series:
  - entity: sensor.hydro_peak_probability
    name: AM
    type: column
    unit: "%"
    yaxis_id: first
    show:
      legend_value: false
      datalabels: false
    time_delta: +4h
    data_generator: |
      const data = [];
      for(let i = 0; i < 12; i++) {
        if (entity.attributes.predictions[i].peak != 'AM')
          continue;

        var date = new Date(entity.attributes.predictions[i].datetime);
        data.push([date, entity.attributes.predictions[i].critical])
      }
      return data;
  - entity: sensor.hydro_peak_probability
    name: PM
    type: column
    unit: "%"
    yaxis_id: first
    show:
      legend_value: false
      datalabels: false
    time_delta: "-3h"
    data_generator: |
      const data = [];
      for(let i = 0; i < 12; i++) {
        if (entity.attributes.predictions[i].peak != 'PM')
          continue;

        var date = new Date(entity.attributes.predictions[i].datetime);
        data.push([date, entity.attributes.predictions[i].critical])
      }
      return data;
  - entity: sensor.hydro_peak_probability
    name: Temp
    type: line
    unit: °C
    opacity: 0.5
    yaxis_id: second
    show:
      legend_value: false
      datalabels: false
    data_generator: |
      const data = [];
      for(let i = 0; i < 12; i++) {

        var date = new Date(entity.attributes.predictions[i].datetime);
        data.push([date, entity.attributes.predictions[i].temp])
      }
      return data;