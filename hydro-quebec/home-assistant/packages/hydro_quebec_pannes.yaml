# Une liste en règle générale les "id" correspondent à ceux disponibles ici: https://www.quebec.ca/gouvernement/portrait-quebec/repertoire-municipalites
# L'id "HQ" correspond à l'ensemble des clients Hydro-Québec
# La liste complète des ID spécifique à HQ est aussi disponible ici: https://infopannes.solutions.hydroquebec.com/assets/data/bilan-par-region.json

rest:
  - resource: https://services-bs.solutions.hydroquebec.com/pan/web/api/v1/bis
    sensor:
      - name: "Hydro-Québec Interruptions - Québec"
        unique_id: hydro-quebec-pannes-hq
        icon: mdi:transmission-tower-off
        unit_of_measurement: "clients"
        value_template: |-
          {% set region = value_json | selectattr('id', 'equalto', 'HQ') | list %}
          {% if region %}
            {{ region[0].nbClientInterrompu }}
          {% else %}
            0
          {% endif %}
        json_attributes_path: "$[?(@.id=='HQ')]"
        json_attributes:
          - "id"
          - "nbClientRaccorde"
          - "nbClientInterrompu" 
          - "nbPanne"
      
      - name: "Hydro-Québec Interruptions - Laurentides"
        unique_id: hydro-quebec-pannes-15
        icon: mdi:transmission-tower-off
        unit_of_measurement: "clients"
        value_template: |-
          {% set region = value_json | selectattr('id', 'equalto', '15') | list %}
          {% if region %}
            {{ region[0].nbClientInterrompu }}
          {% else %}
            0
          {% endif %}
        json_attributes_path: "$[?(@.id=='15')]"
        json_attributes:
          - "id"
          - "nbClientRaccorde"
          - "nbClientInterrompu" 
          - "nbPanne"